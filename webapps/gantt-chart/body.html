<link rel="stylesheet" href="/plugins/gantt-chart/resource/frappe-gantt.css">
<link rel="stylesheet" href="/plugins/gantt-chart/resource/webapp/style.css">

<div id="gantt-container"></div>

<div id="loading" class="loading-overlay">
    <div class="spinner"></div>
    <p>Loading Gantt chart...</p>
    <p id="debug-status" style="font-size: 10px; color: #999; margin-top: 10px;">Initializing...</p>
</div>

<script src="/plugins/gantt-chart/resource/frappe-gantt.umd.js"></script>

<!-- Inline Debug Script to verify environment -->
<script>
    (function() {
        console.log('[Inline Debug] Script running');
        var statusEl = document.getElementById('debug-status');
        
        function updateStatus(msg) {
            console.log('[Inline Debug] ' + msg);
            if (statusEl) statusEl.textContent = msg;
        }

        updateStatus('Step 1: Checking libraries...');
        
        // Check Dataiku object
        if (typeof dataiku === 'undefined') {
            updateStatus('Error: dataiku object missing');
            return;
        }
        
        // Check Gantt library
        if (typeof Gantt === 'undefined') {
            updateStatus('Error: Frappe Gantt library missing');
            return;
        }

        updateStatus('Step 2: Checking backend connection...');

        if (!dataiku.webappBackend) {
            updateStatus('Warning: dataiku.webappBackend missing. Checking dependencies...');
            if (typeof $ === 'undefined') {
                updateStatus('Error: jQuery missing (required for webappBackend)');
                return;
            }
            // Attempt to construct if missing (rare case for standard webapps)
            updateStatus('Error: dataiku.webappBackend is undefined. Cannot fetch data.');
            return;
        }

        updateStatus('Step 3: Pinging backend...');
        dataiku.webappBackend.get('frontend-log', {message: 'Inline script running'})
            .then(function() {
                updateStatus('Backend connected. Loading app...');
            })
            .catch(function(err) {
                updateStatus('Backend ping failed: ' + JSON.stringify(err));
                console.error('Backend ping failed', err);
            });
    })();
</script>

<script src="/plugins/gantt-chart/resource/webapp/app.js"></script>