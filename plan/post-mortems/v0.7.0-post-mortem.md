# Post-Mortem: v0.7.0

**Branch:** `feature/v0.7.0-expected-progress-and-polish`
**Type:** Feature
**Duration:** 1 day (Started: 2025-12-26, Completed: 2025-12-26)
**Outcome:** Success

---

## Summary

Implemented expected progress indicator feature and several polish improvements. Encountered two significant bugs during QA - one in our CSS selector handling, one in the frappe-gantt library itself - both successfully resolved.

---

## Scope

### Planned
- [x] #33 - Expected Progress Indicator
- [x] #45 - Bar corner radius default to 10
- [x] #43 - Remove 'Disable all Editing' option
- [x] #42 - Weekend highlighting off by default
- [x] #38 - Float dependency strings normalization
- [x] #37 - Pandas deprecation warning

### Delivered
All planned items delivered.

### Deferred Items
None.

---

## Commit Analysis

| Metric | Value | Assessment |
|--------|-------|------------|
| Total commits | 11 | |
| Feature commits | 1 | |
| Fix/debug commits | 6 | |
| Docs commits | 4 | |
| Reverts | 0 | |
| Churn ratio | 55% | High - but expected due to library bug discovery |

High churn ratio explained: The expected progress feature worked correctly in Week view but exposed a pre-existing Month view positioning bug in frappe-gantt. Finding and patching this library bug required multiple debug iterations.

---

## What Went Well

- **Robust ID encoding**: Hex-encoding solution (`_xHH_` pattern) is deterministic, collision-free, and reversible
- **Incremental debugging**: Console logging in app.js allowed quick identification of DOM lookup issues
- **Library bug documentation**: Added Bug #6 to upstream tracking with complete root cause analysis
- **QA feedback loop**: 5 QA rounds with clear pass/fail criteria ensured thorough testing

---

## What Didn't Go Well

- **Frappe-gantt CSS class generation**: Library creates CSS classes from task properties, so float values like `expected_progress: 55.67` caused `.highlight-55.67` which is invalid CSS
- **DOM structure assumptions**: Initial DOM lookup used `.closest('.bar-group')` which traverses UP the tree, but `.bar-group` is a CHILD of `.bar-wrapper`
- **Month view positioning**: Pre-existing library bug was not discovered until expected progress markers revealed the offset

---

## Blockers Encountered

| Blocker | Impact | Resolution | Time Lost |
|---------|--------|------------|-----------|
| CSS selector error from float IDs | Chart crashed on hover | Hex-encode non-alphanumeric chars | 1 hour |
| DOM lookup returned null | Markers not added | Fixed to use correct element hierarchy | 30 min |
| Month view bars ~1 month late | Wrong marker positions | Patched frappe-gantt diff() function | 2 hours |

---

## Technical Discoveries

### Platform Behavior
- None new

### Library Behavior
- **Frappe-gantt uses task properties for CSS classes**: Any property with invalid CSS characters will crash. Prefix with `_` to exclude from class generation.
- **Frappe-gantt Month view diff() bug**: Uses `o%30/30` for fractional month calculation, which is meaningless. Should be `(n.getDate()-1)/30`.
- **DOM structure**: `data-id` attribute is on `.bar-wrapper`, not `.bar-group`. `.bar-group` is a child of `.bar-wrapper`.

### Architecture Insights
- **Display vs internal values**: When encoding values for CSS/DOM safety, always store original value separately for display (e.g., `_display_id`).

---

## CLI Docs Candidates

Items added to CLAUDE.md:

1. **Frappe Gantt Month view diff() bug**: `o%30/30` gives meaningless fractional; patched to `(n.getDate()-1)/30`

---

## Recommendations

### For Next Release
- Consider removing debug logging added during this release

### Process Improvements
- None needed - QA rounds worked effectively

### Technical Debt
- Debug logging in app.js could be removed or made conditional

---

## Lessons Learned

1. **Library bugs can hide in plain sight**: The Month view positioning bug existed in all previous versions but wasn't noticed because it affected all bars equally. The expected progress marker (which uses JavaScript Date calculations, not the library) revealed the discrepancy.

2. **CSS selector safety is non-obvious**: Task IDs that look valid (`54.8`) become invalid CSS selectors (`.highlight-54.8`). Always sanitize external data used in selectors.

3. **DOM traversal direction matters**: `.closest()` goes UP, `.querySelector()` goes DOWN. Know which element has the attribute you need.
