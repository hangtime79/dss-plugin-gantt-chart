# Post-Mortem: v0.4.1

**Branch:** `bugfix/v0.4.1-fix-view-transitions`
**Type:** Bugfix
**Duration:** 1 day (Started: 2025-12-22, Completed: 2025-12-22)
**Outcome:** âœ… Success

---

## Summary

Fixed 5 critical bugs in the Frappe Gantt library that caused view mode transitions to fail, scroll positions to jump incorrectly, and the Today button to malfunction in Month/Year views. All bugs were library issues requiring patches to the bundled `frappe-gantt.es.js` and `frappe-gantt.umd.js` files.

---

## Scope

### Planned (from spec)
- [x] Fix data fails to populate on view transitions
- [x] Fix scroll position jumps on mode switch

### Delivered
- [x] Fix data fails to populate (Bug #2: maintain_scroll)
- [x] Fix scroll position jumps (same fix)
- [x] Fix SVG width 100% partial render (Bug #3: discovered in QA)
- [x] Fix Month/Year Today button (Bug #4: discovered in QA)
- [x] Fix zoom-out auto-center (Bug #5: discovered in QA)

### Deferred Items
None - all discovered issues were fixed in this release.

---

## Timeline

| Milestone | Planned | Actual | Variance |
|-----------|---------|--------|----------|
| Start | 2025-12-22 | 2025-12-22 | - |
| Initial fix | - | 2025-12-22 | - |
| QA Round 1 | - | 2025-12-22 | Found Bug #3 |
| QA Round 2 | - | 2025-12-22 | Found Bug #4 |
| QA Round 3 | - | 2025-12-22 | Found Bug #5 |
| QA Final | - | 2025-12-22 | âœ… Pass |
| Release | 2025-12-22 | 2025-12-22 | On time |

---

## Commit Analysis

| Metric | Value | Assessment |
|--------|-------|------------|
| Total commits | 11 | |
| Feature/fix commits | 4 | |
| Documentation commits | 7 | |
| Reverts | 0 | |
| Churn ratio | 0% | ðŸŸ¢ Low |

Clean linear development with thorough documentation at each step.

---

## What Went Well

- **Systematic QA**: Each QA round identified specific issues that were root-caused and fixed
- **Library bug tracking**: Created `frappe-gantt-upstream-bugs.md` to document all library issues for potential upstream contribution
- **Incremental fixes**: Each bug was addressed independently with clear commits
- **Detailed intervention logging**: Full debugging context preserved for future reference

---

## What Didn't Go Well

- **Initial fix incomplete**: The original spec only identified 2 bugs, but QA discovered 3 more
- **Smooth scroll approach failed**: First attempt to fix zoom-out centering (re-scroll in on_view_change) didn't work; required deeper library patch

---

## Blockers Encountered

| Blocker | Impact | Resolution | Time Lost |
|---------|--------|------------|-----------|
| SVG width 100% | Partial render from Hour view | Patch set_dimensions() | ~30 min |
| Date parsing in Month/Year | Today button broken | Patch get_closest_date() | ~30 min |
| Smooth scroll timing | Zoom-out didn't center | Patch to instant scroll | ~1 hour |

---

## Technical Discoveries

### Library Behavior
- **Frappe Gantt's `maintain_scroll` is broken**: It tries to preserve pixel scroll position across different time scales, which is meaningless
- **Smooth scroll + immediate read = race condition**: The library uses `behavior: "smooth"` but immediately reads `scrollLeft`, which still has the old value
- **Date format + reparse is fragile**: `new Date("2024-12 ")` returns Invalid Date; trailing space breaks parsing for Month/Year formats
- **set_dimensions() conditional logic fails**: Only sets pixel width when container is smaller than content; fails when container is already wide from previous view

### Architecture Insights
- **Always patch both .es.js and .umd.js**: Browser loads the UMD version, but keeping ES version in sync prevents future confusion
- **Guard all DOM lookups**: Library assumes DOM elements exist; view mode transitions can leave stale references

---

## CLI Docs Candidates

1. **Frappe Gantt Library Patches**: Document that the bundled library has known bugs and patches must be reapplied when updating
2. **Smooth scroll timing**: When using `behavior: "smooth"`, don't read scroll position immediately after

---

## Recommendations

### For Next Release
- Consider extracting library patches into a separate patch file for easier maintenance
- Add automated regression tests for view mode transitions

### Process Improvements
- Include "zoom out" scenarios in view transition testing (not just zoom in)
- Test Today button in all views, not just Day/Week

### Technical Debt
- Upstream the 5 library bugs to Frappe Gantt repository
- Consider forking the library if upstream is unresponsive

---

## Lessons Learned

1. **Library bugs cascade**: One symptom (data not rendering) had multiple root causes in different parts of the library
2. **QA reveals edge cases**: Initial fix addressed happy path; QA found Month/Year and zoom-out edge cases
3. **Async scroll is tricky**: Modern scroll APIs use smooth animation by default; code that reads position immediately will get stale values
4. **Document everything**: The intervention log and upstream bugs doc will save hours of debugging if these issues resurface
