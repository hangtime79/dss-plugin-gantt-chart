# Post-Mortem: v0.10.1

**Branch:** `feature/v0.10.1-custom-palettes`
**Type:** Feature
**Duration:** 1 day (Started: 2025-12-29, Completed: 2025-12-29)
**Outcome:** âœ… Success

---

## Summary

Implemented admin-defined custom color palettes using Dataiku's parameter set (PRESET) mechanism. The feature required significant debugging to understand how PRESET parameters work differently in webapps vs recipes/connectors.

---

## Scope

### Planned
- [x] Parameter set for custom palettes
- [x] Custom option in color palette dropdown
- [x] PRESET selector with visibility condition
- [x] Backend preset resolution
- [x] Hex color validation
- [x] Dynamic CSS injection with text contrast

### Delivered
All planned items delivered.

### Deferred Items
None

---

## Commit Analysis

| Metric | Value | Assessment |
|--------|-------|------------|
| Total commits | 5 | |
| Feature commits | 1 | |
| Fix/debug commits | 4 | |
| Reverts | 0 | |
| Churn ratio | 80% | ðŸ”´ High (API discovery) |

**Churn explanation:** High churn ratio due to iterative API discovery. The Dataiku PRESET mechanism works differently in webapps (raw references) vs recipes (auto-resolved). Required 4 iterations to find correct API pattern:

1. Initial implementation assumed auto-resolution (wrong)
2. Added debug logging to discover raw reference format
3. First API attempt with wrong method names
4. Final fix: `preset.config` is a property, not `preset.get_config()`

---

## What Went Well

- Clean architecture: CSS injection with luminance-based text contrast
- Parameter set structure follows Dataiku patterns
- Hex validation handles 3-digit and 6-digit formats
- Graceful fallback to classic palette on errors

---

## What Didn't Go Well

- Assumed PRESET params auto-resolve in webapps (they don't)
- Searched for wrong API methods initially
- `config` is a property vs `get_config()` method distinction not obvious

---

## Blockers Encountered

| Blocker | Impact | Resolution | Time Lost |
|---------|--------|------------|-----------|
| PRESET not resolving | Colors defaulted to classic | Added resolve_preset() | 1 hour |
| Wrong API method | AttributeError | Found correct API path | 30 min |
| Property vs method | AttributeError | Changed to `preset.config` | 30 min |

---

## Technical Discoveries

### Platform Behavior
1. **Webapps receive raw PRESET references** - Unlike recipes where Dataiku auto-resolves PRESET params to dicts, webapps receive `{"mode": "PRESET", "name": "PRESET_3"}` and must manually resolve via API

2. **DSSPluginPreset.config is a property** - Use `preset.config`, not `preset.get_config()`. The API documentation is sparse on this detail.

3. **Preset resolution API path**:
   ```python
   client = dataiku.api_client()
   plugin = client.get_plugin("plugin-id")
   settings = plugin.get_settings()
   parameter_set = settings.get_parameter_set("param-set-id")
   preset = parameter_set.get_preset("PRESET_NAME")
   values = preset.config  # Property, not method!
   ```

### Library Behavior
- WCAG luminance formula works well for auto text contrast
- CSS injection timing not critical - can inject before render

---

## CLI Docs Candidates

Items added to CLAUDE.md gotchas:

1. **Webapp PRESET params are raw references** - Must resolve via API, not auto-resolved like in recipes
2. **DSSPluginPreset.config is a property** - Not a method, don't use get_config()

---

## Recommendations

### For Next Release
- Consider adding color preview in parameter set UI (not possible with current TEXTAREA)

### Process Improvements
- Check Dataiku API examples before assuming behavior matches recipes

### Technical Debt
- Unit test collection errors need investigation (ScenarioConfiguration)

---

## Lessons Learned

1. Dataiku has different behavior for PRESET params across component types (webapp vs recipe)
2. Always check if Python attributes are properties vs methods
3. Debug logging early is valuable for understanding framework behavior
