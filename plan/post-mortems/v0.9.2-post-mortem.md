# Post-Mortem: v0.9.2

**Branch:** `feature/v0.9.2-visual-polish`
**Type:** Feature + Bugfix
**Duration:** 1 day (Started: 2025-12-28, Completed: 2025-12-28)
**Outcome:** âœ… Success

---

## Summary

Implemented three visual polish features (#62, #63, #64) and discovered/fixed a pre-existing bug in the upper header year display logic. The year bug required multiple iterations to resolve correctly, with the final solution being elegantly simple.

---

## Scope

### Planned
- [x] #62: Standardize task label positioning (right-aligned)
- [x] #63: Center completion checkmark in bars
- [x] #64: Fix progress bar accuracy with corner radius

### Delivered
- [x] #62: Labels consistently right-aligned with 45px offset
- [x] #63: Checkmarks centered using true center calculation
- [x] #64: Removed width extension that overstated progress
- [x] Bonus: Fixed year display bug in upper headers

### Deferred Items
None

---

## Commit Analysis

| Metric | Value | Assessment |
|--------|-------|------------|
| Total commits | 4 | |
| Feature commits | 1 | |
| Fix/debug commits | 3 | |
| Reverts | 1 | |
| Churn ratio | 75% | ðŸ”´ High |

**Why high churn:** The year display bug fix went through three iterations:
1. First attempt: Custom `view_modes` - broke other functionality
2. Reverted
3. Final fix: Index-based lookup - simple and correct

The high churn was due to exploring the wrong solution space before understanding the true root cause.

---

## What Went Well

- **#62, #63, #64 implemented cleanly** - The spec was clear and implementation straightforward
- **User-guided debugging** - User identified the root cause of the year bug after initial fix failed
- **Simple final solution** - The index-based lookup is 3 lines of code vs 20+ lines of the original approach

---

## What Didn't Go Well

- **Jumped to implementation before understanding** - First year fix attempt (custom view_modes) was complex and broke things
- **Didn't question the original design** - The existing `ensureYearInUpperHeaders()` was already flawed; should have traced the issue more carefully

---

## Blockers Encountered

| Blocker | Impact | Resolution | Time Lost |
|---------|--------|------------|-----------|
| Year display bug | QA failed | User-guided root cause analysis | ~30 min |
| Custom view_modes broke functionality | Had to revert | Simplified to index-based lookup | ~20 min |

---

## Technical Discoveries

### The Year Display Bug

**Symptom:** Upper header showed "Dec 2023" when it should show "Dec 2024"

**Root Cause:** The original code searched the entire dates array for a matching month:
```javascript
// FLAWED: Finds first December in array, regardless of position
const matchingDate = ganttInstance.dates.find(d => d.getMonth() === monthNum);
```

When timeline spans multiple years (e.g., Dec 2023 â†’ Dec 2024), this finds the FIRST December (2023) instead of the one at the element's position.

**Failed Approach:** Tried to fix by passing custom `view_modes` to Frappe Gantt with "MMMM YYYY" format. This was complex and broke other functionality.

**Correct Solution:** Use element position to calculate array index:
```javascript
const elementX = parseFloat(text.style.left) || 0;
const dateIndex = Math.round(elementX / columnWidth);
const elementDate = ganttInstance.dates[dateIndex];  // Direct lookup, not search
```

### Key Insight: Position Encodes Index

In Frappe Gantt's header:
- Each column has fixed width (`columnWidth`)
- Element position (`style.left`) = index Ã— columnWidth
- Therefore: index = position / columnWidth
- And: `dates[index]` gives the exact date at that position

This is a general pattern: **when post-processing positioned DOM elements, use position to derive index rather than searching by content**.

---

## CLI Docs Candidates

1. **Position-based date lookup** â€” When modifying header text post-render, don't search `ganttInstance.dates` by content (month name). Use `dates[elementX / columnWidth]` for direct index lookup.

2. **Custom view_modes complexity** â€” While Frappe Gantt accepts custom `view_modes`, overriding them can break internal consistency. Prefer post-render DOM manipulation for simple formatting changes.

---

## Recommendations

### For Next Release
- When fixing bugs, trace the issue to root cause before implementing
- Simple solutions are usually better than complex ones

### Process Improvements
- Add position-based lookup pattern to institutional memory
- When a fix breaks things, step back and question assumptions

### Technical Debt
- None introduced

---

## Lessons Learned

1. **Search vs Lookup** â€” Searching by content (`find()`) can find wrong matches; lookup by index (`array[i]`) is deterministic
2. **Position is data** â€” DOM element positions encode information that can be reverse-engineered
3. **User collaboration** â€” User's root cause analysis led directly to the correct fix
