# Post-Mortem: v0.7.1

**Branch:** `bugfix/v0.7.1-sticky-header-narrow-content`
**Type:** Bugfix
**Duration:** 1 day (Started: 2025-12-26, Completed: 2025-12-27)
**Outcome:** âœ… Success

---

## Summary

Fixed sticky header jankiness when chart content was narrower than the viewport. The original spec proposed date range expansion, but implementation pivoted to dynamic zoom adjustment for edge-to-edge content. After 12 QA iterations, the solution uses per-view zoom tracking with automatic floor enforcement.

---

## Scope

### Planned
- [x] Fix sticky header jank on narrow content (#21)
- [x] Ensure content fills viewport width

### Delivered
- [x] Fix sticky header jank on narrow content (#21)
- [x] Edge-to-edge content via dynamic zoom
- [x] Per-view independent zoom tracking (enhancement)
- [x] User feedback on zoom limits (enhancement)
- [x] Config panel spinner feedback (enhancement)

### Deferred Items
| Item | Reason | Target |
|------|--------|--------|
| Marker alignment at low granularities | Cosmetic, not blocking | #52 |
| Zoom stops at round percentages | Feature request | #53 |
| Intermittent zoom carryover | Low priority, rare | #54 |

---

## Commit Analysis

| Metric | Value | Assessment |
|--------|-------|------------|
| Total commits | 10 | |
| Feature/fix commits | 7 | |
| Docs commits | 3 | |
| Reverts | 0 | |
| Churn ratio | 70% | ðŸŸ¡ Medium (expected for iterative bugfix) |

**Note:** High churn ratio is expected for this fix. The issue required 12 QA iterations to fully resolve, with each iteration refining the zoom/floor calculation logic. No reverts indicates forward progress despite iteration count.

---

## What Went Well

- **Pivot from spec approach:** Original date expansion approach was superseded by zoom-based solution, which proved simpler and more effective
- **Per-view tracking:** Enhancement beyond spec provides better UX - users don't lose zoom preference when switching views
- **User feedback:** Zoom limit messages help users understand behavior constraints
- **Thorough QA:** 12 iterations caught edge cases like message surviving re-renders, wrong column width detection after view switch

---

## What Didn't Go Well

- **Many iterations required:** 12 QA rounds indicates initial implementation missed edge cases
- **Guard logic complexity:** Multiple guards needed (`edgeToEdgeInProgress`, view mode checks) to prevent infinite loops
- **State management challenge:** Per-view zoom tracking required careful coordination between user zoom preference and calculated floor

---

## Blockers Encountered

| Blocker | Impact | Resolution | Time Lost |
|---------|--------|------------|-----------|
| Library re-render cleared messages | Zoom limit message disappeared | Insert before container, not inside | 1 iteration |
| View switch reset zoom | Per-view preference lost | Separate tracking per view mode | 2 iterations |
| Infinite loop on auto-zoom | Browser freeze | Added edgeToEdgeInProgress guard | 1 iteration |

---

## Technical Discoveries

### Platform Behavior
- **Dataiku iframe context:** DOM queries from parent console return empty; debug logging must be in app.js code

### Library Behavior
- **frappe-gantt on_view_change mode parameter:** The `mode` passed is an object `{name, padding, step, ...}`, not a string. Use `mode.name` to get the view mode string.
- **DOM insertion timing:** Messages inserted into container are destroyed on re-render; must insert before container

### Architecture Insights
- **Per-view state pattern:** Tracking state per view mode (like `columnWidthByViewMode`) enables better UX than global state
- **Floor vs preference:** Distinguishing between "user wants X" and "minimum allowed is Y" prevents edge cases

---

## CLI Docs Candidates

Items added to CLAUDE.md during this work:

1. **on_view_change mode parameter:** Mode is object, not string - use `mode.name`
2. **Dataiku iframe context:** DOM queries from parent console return empty
3. **Sticky header narrow content:** JS transform-based sticky needs edge-to-edge content

---

## Recommendations

### For Next Release
- Consider exposing zoom controls in config panel for user-adjustable minimum zoom

### Process Improvements
- For complex JS bugs, consider creating render flow documentation upfront (like `render-flow-pseudocode.md`)

### Technical Debt
- None introduced; code is well-documented

---

## Lessons Learned

1. **Browser rendering quirks require content-based solutions** - CSS alone couldn't fix the paint/composite issue; needed to ensure content fills viewport
2. **Per-view state provides better UX** - Users expect each view to remember its settings independently
3. **Guard patterns essential for event-driven code** - Flags like `edgeToEdgeInProgress` prevent cascading re-renders
