# Post-Mortem: v0.9.4

**Branch:** `feature/v0.9.4-tooltip-polish`
**Type:** Feature
**Duration:** 1 day (Started: 2025-12-28, Completed: 2025-12-28)
**Outcome:** âœ… Success

---

## Summary

Implemented tooltip positioning and appearance improvements. The appearance fix (#67) was straightforward CSS. The positioning fix (#66) required significant iteration due to Frappe Gantt's internal popup handling behavior, ultimately resulting in a complete rewrite of the approach.

---

## Scope

### Planned
- [x] #66 - Anchor tooltip to task bar instead of mouse cursor
- [x] #67 - Reduce tooltip padding and fix dark mode halo

### Delivered
- [x] #66 - Tooltip positioning with post-render correction
- [x] #67 - Padding reduced, dark mode border added
- [x] CSS variable for theme-driven gap
- [x] Auto-flip above bar when near bottom
- [x] Boundary clamping

### Deferred Items
None

---

## Commit Analysis

| Metric | Value | Assessment |
|--------|-------|------------|
| Total commits | 8 | |
| Feature commits | 2 | |
| Fix/debug commits | 5 | |
| Reverts | 0 | |
| Churn ratio | 62.5% | ðŸ”´ High (expected for debugging session) |

**Why high churn:** The original spec approach (modifying `opts.x/y` before `show_popup`) didn't account for Frappe Gantt's post-render repositioning. Multiple iterations were needed to discover the library's behavior and arrive at the correct solution.

---

## What Went Well

- **User-guided debugging:** User identified sign errors and provided the final working approach
- **Iterative refinement:** Each fix commit addressed a specific issue identified during testing
- **Clean final solution:** The post-render correction approach is robust and maintainable
- **CSS variable:** Makes the gap configurable for future theming needs

---

## What Didn't Go Well

- **Initial approach was wrong:** Spec assumed modifying opts before show_popup would work
- **Coordinate math errors:** Multiple sign errors (+30 vs -30, x vs y directions)
- **Fighting the library:** Spent time trying to pre-position when post-correction was needed

---

## Blockers Encountered

| Blocker | Impact | Resolution | Time Lost |
|---------|--------|------------|-----------|
| Frappe post-render repositioning | Initial approach failed | Rewrote to use requestAnimationFrame | ~1 hour |
| Coordinate system confusion | Wrong positioning | User provided correct math | ~30 min |

---

## Technical Discoveries

### Library Behavior
- **Frappe Gantt popup positioning:** Library treats popup coords as anchors and re-centres after render. Cannot reliably pre-position; must correct post-render.
- **Animation preservation:** Must temporarily disable CSS transition when correcting position to prevent visual jump.

### Patterns That Worked
- **Post-render correction:** Call original function first, then correct in `requestAnimationFrame`
- **CSS variables for spacing:** `--gantt-popup-gap` allows theme-driven configuration
- **Boundary clamping:** Using `scrollWidth/scrollHeight` for max bounds

---

## CLI Docs Candidates

Added to CLAUDE.md:

1. **Frappe Gantt popup positioning**: Don't fight library by modifying opts before show_popup. Use post-render correction in requestAnimationFrame.

---

## Recommendations

### For Next Release
- Consider adding configurable positioning modes (left-trailing, right-trailing, centered)
- May want to add smart edge detection for tooltips near left edge

### Process Improvements
- When patching library methods, test the library's internal behavior first before implementing
- Read library source to understand post-render effects

### Technical Debt
- None introduced

---

## Lessons Learned

1. **Let libraries do their thing first:** When monkey-patching, calling the original function first and correcting afterward is often more robust than trying to pre-configure.

2. **Test assumptions about coordinates:** Screen Y increases downward; easy to confuse +/- directions.

3. **CSS variables for configuration:** Using CSS custom properties for layout values allows future theming without JS changes.
