# Post-Mortem: v0.1.0 Feature Branch Failure Analysis

**Branch:** `feature/v0.1.0-ux-improvements`
**Date Range:** 2025-12-18 to 2025-12-19
**Total Commits:** 38 (29 fix/debug commits, 2 reverts)
**Outcome:** Abandoned - Critical UI failures unresolved

---

## Executive Summary

The v0.1.0 feature branch attempted to implement 4 major UX improvements. While backend logic was successfully implemented and tested (90/90 unit tests passing), the frontend UI changes created cascading failures that proved impossible to resolve. The core issue was a **fundamental misunderstanding of how Frappe Gantt manages its DOM structure** combined with **Dataiku webapp file loading conventions**.

---

## 1. What Was Attempted

### Feature 1: Top Bar Configuration
**Goal:** Move mandatory data columns (ID, Start, End) to the Top Bar and optional columns to the Sidebar.
**Status:** Backend complete, Frontend rendering issues

### Feature 2: Custom Tooltips
**Goal:** Allow users to add custom data fields to task popups (max 5 fields).
**Status:** Backend data flow working, Frontend showing "Untitled Task" or missing fields

### Feature 3: Task Sorting
**Goal:** Add 10 sort options (by start/end date, name, duration, dependencies).
**Status:** Fully implemented and tested (new `sort_utils.py` with Kahn's algorithm)

### Feature 4: Auto-Fit to Screen
**Goal:** Chart automatically expands to fill available viewport width.
**Status:** Initial logic worked, Broke scrollbar functionality

---

## 2. What Went Wrong - The Cascade of Failures

### Stage 1: Initial Feature Implementation (Commit f970a4f)
- Implemented all 4 features in one large commit
- Backend tests passed (90/90)
- **Problem:** No incremental testing of frontend changes

### Stage 2: File Structure Confusion (Commits 8a361a6 to 03e9b3a)
**The Duplicate File Problem:**
- Webapp had files in TWO locations:
  - `webapps/gantt-chart/app.js` (auto-loaded by Dataiku)
  - `resource/webapp/app.js` (manually loaded via body.html)
- Dataiku loads `webapps/<name>/app.js` automatically for "STANDARD" webapps
- The manual `<script>` tag in body.html loaded a second copy
- **Result:** Two versions running simultaneously, outdated code overriding new code

**Failed Fix Attempts:**
1. Deleted `webapps/gantt-chart/app.js` - Platform error: "no JavaScript file"
2. Restored files - Back to duplicate loading issue
3. Final state: Files in `webapps/` folder, but body.html patterns unclear

### Stage 3: The Scrollbar Nightmare (Commits 9a08bd9 to f462234)

**11 consecutive fix attempts for scrollbars, all failed:**

| Attempt | Approach | Result |
|---------|----------|--------|
| 1 | Set `overflow: auto` on `#gantt-container` | No scrollbar appeared |
| 2 | Force `overflow: scroll` | Scrollbar track visible but non-functional |
| 3 | Explicitly set SVG width/height in JS | No change |
| 4 | Add webkit scrollbar styles | Cosmetic only |
| 5 | Override Frappe's `.gantt-container` wrapper | **Blank chart** - collapsed height |
| 6 | Revert CSS, add load retry polling | Chart returned, scrollbars still broken |
| 7 | Set outer container `overflow: hidden`, inner `overflow: auto` | Horizontal worked, vertical broken |
| 8 | Parse SVG height attribute | `parseInt("100%")` returned `100` = 100px height |
| 9 | Check for `%` suffix before parsing | No change |
| 10 | Force height to 2000px | Debug test - still no scrollbar |
| 11 | Filter long tasks | Reverted - unrelated to issue |

**Root Cause Never Found:**
The nested DOM structure created by Frappe Gantt was:
```
#gantt-container (Plugin)
  - .gantt-container (Frappe wrapper, has overflow: auto)
    - svg (actual chart content)
```

The interaction between these layers, Dataiku's iframe constraints, and CSS inheritance created an unsolvable conflict.

### Stage 4: Tooltip Failures
**Symptoms:**
- Popup header showing "Untitled Task" instead of task name
- Custom fields not appearing
- Dates showing as "to" (missing values)

**Suspected Causes:**
- `tooltipColumns` param sometimes passed as `[""]` (empty string in array)
- Case sensitivity mismatch between column names
- Frontend `task` object not receiving `custom_fields` data

**Never Debugged:** Focus shifted entirely to scrollbar issues.

### Stage 5: Date Picker Failures
**Symptom:** "Go" button did nothing when clicked.
**Suspected Cause:** `scrollToDate` function couldn't calculate correct pixel offset.
**Never Fixed:** Lower priority than scrollbar issues.

---

## 3. Commits Analysis

### Commit Pattern (Red Flag)
```
38 total commits:
 - 2 feature commits
 - 6 docs commits
 - 28 fix/debug commits (74%)
 - 2 reverts
```

The 74% fix rate indicates the branch was in constant firefighting mode with no forward progress.

### Key Problematic Commits
| Commit | Description | Problem |
|--------|-------------|---------|
| `0227fca` | "feat: Implement v0.1.0 UX improvements" | Too large, should have been incremental |
| `8a361a6` | "fix: Remove duplicate app.js and style.css" | Broke platform loading |
| `03e9b3a` | "fix: Restore app.js/style.css to webapp root" | Undo of previous fix |
| `29d261e` | "fix(debug): Override Frappe wrapper styles" | Caused blank chart |
| `d5f805c` | "fix(debug): Revert CSS override" | Undo of previous fix |
| `8cf5f23` | "fix(debug): Force SVG height to 2000px" | Desperation debugging |

---

## 4. Root Causes

### 1. Insufficient Understanding of Frappe Gantt Internals
- Did not study how Frappe Gantt creates its DOM structure
- Did not understand its internal scrolling mechanism
- Attempted to override its behavior without understanding it

### 2. Dataiku Webapp Architecture Confusion
- Unclear on when files are auto-loaded vs. manually loaded
- `STANDARD` vs other webapp types have different behaviors
- `body.html` as fragment vs. full document unclear

### 3. Too Many Changes at Once
- All 4 features implemented simultaneously
- No incremental testing after each feature
- When things broke, impossible to isolate cause

### 4. CSS Specificity Wars
- Multiple stylesheets competing: `frappe-gantt.css`, plugin `style.css`, Dataiku platform CSS
- `!important` overrides created unpredictable cascades
- No clear CSS architecture

### 5. No Browser DevTools Debugging
- Console logs were added but results never systematically analyzed
- No step-through debugging of JavaScript
- CSS computed styles not inspected in browser

---

## 5. What Actually Worked

Despite the failures, some components are solid and can be reused:

### Fully Working (Salvaged)
1. **`python-lib/ganttchart/sort_utils.py`** - All 10 sort algorithms including topological sort
2. **`tests/python/unit/test_sort_utils.py`** - Comprehensive test coverage
3. **Backend tooltip column extraction** - Data flow to frontend works
4. **OOM mitigation** - Row limits in `get_dataframe()` call

### Partially Working (Needs Refinement)
1. **Auto-fit calculation logic** - Math is correct, integration broke scrolling
2. **Date picker UI** - Toolbar renders, scroll function needs debugging

### Broken (Needs Complete Rewrite)
1. **Scrollbar handling** - Start fresh with Frappe Gantt documentation
2. **Tooltip popup rendering** - Debug `task` object structure first
3. **CSS architecture** - Need clear layering strategy

---

## 6. Lessons Learned

### For Next Attempt

1. **Incremental Development**
   - Implement ONE feature at a time
   - Test in browser after EACH change
   - Commit only when feature is verified working

2. **Study Frappe Gantt First**
   - Read source code for DOM structure
   - Understand its scroll handling
   - Don't fight the library, work with it

3. **Clarify Dataiku Webapp Conventions**
   - Document exactly which files are auto-loaded
   - Test with minimal body.html first
   - Avoid manual script tags if possible

4. **CSS Strategy**
   - Define clear layering: base - library - plugin - overrides
   - Avoid `!important` unless absolutely necessary
   - Test CSS changes in isolation

5. **Browser Debugging**
   - Use DevTools to inspect actual DOM
   - Check computed styles on problem elements
   - Step through JavaScript execution

6. **Smaller Scope**
   - Consider implementing only 1-2 features per release
   - Task Sorting is ready - could be v0.1.0 alone
   - Auto-fit is complex - could be v0.2.0

---

## 7. Recommended Next Steps

1. **Reset to `main`** - Abandon this branch entirely
2. **Create new branch `feature/v0.1.0-task-sorting`** - Just sorting feature
3. **Test sorting in isolation** - Verify it doesn't break existing functionality
4. **Research Frappe Gantt scrolling** - Before attempting auto-fit
5. **Implement auto-fit as v0.2.0** - After scrolling is understood

---

## Conclusion

The v0.1.0 attempt failed due to architectural misunderstandings compounded by too-broad scope. The backend work is solid and reusable. The frontend issues stem from not understanding the interaction between Frappe Gantt's internal DOM management, Dataiku's webapp loading, and CSS inheritance. A fresh start with narrower scope and more research is recommended.
