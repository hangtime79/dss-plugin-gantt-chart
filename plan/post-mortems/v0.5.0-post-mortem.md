# Post-Mortem: v0.5.0

**Branch:** `feature/v0.5.0-ui-overhaul`
**Type:** Feature
**Duration:** 1 day (Started: 2025-12-25, Completed: 2025-12-25)
**Outcome:** Success (with significant cleanup required)

---

## Summary

A comprehensive UI overhaul was implemented by a junior developer, then handed off to a senior architect for cleanup after 7 failed iterations. The senior architect fixed critical bugs, added progress-based default coloring, and completed the feature. High churn ratio (67%) reflects the handoff situation.

---

## Scope

### Planned
- [x] Design system with CSS variables
- [x] Control bar with view mode, zoom, today button
- [x] Skeleton loader for initial load
- [x] Visual polish (colors, shadows, typography)

### Delivered
- [x] All planned items
- [x] Progress-based default colors (added during cleanup)
- [x] 60% height progress bars, centered

### Deferred Items

None.

---

## Commit Analysis

| Metric | Value | Assessment |
|--------|-------|------------|
| Total commits | 9 | |
| Feature commits | 2 | |
| Fix/debug commits | 6 | |
| Docs commits | 1 | |
| Churn ratio | 67% | High (handoff situation) |

**High churn explanation:** Junior developer committed with multiple critical bugs (DOCTYPE, dark labels on dark bars). After 7 failed iterations, work was handed off to senior architect who fixed issues and added new feature.

---

## What Went Well

- **Design system implementation**: CSS variables well-structured, maintainable
- **Air-gap compliance**: Inline SVGs, system fonts, no external dependencies
- **Control bar architecture**: Clean separation, proper flexbox layout
- **Quick senior intervention**: Once handed off, issues resolved efficiently

---

## What Didn't Go Well

- **7 failed iterations before handoff**: Junior couldn't fix a one-line DOCTYPE issue
- **No intervention file created**: Despite complex, multi-iteration work
- **Protocol violations**: Spec naming, missing sections, premature commits
- **Debugging methodology gaps**: Not reading error messages, not understanding context

---

## Blockers Encountered

| Blocker | Impact | Resolution | Time Lost |
|---------|--------|------------|-----------|
| DOCTYPE in body.html | Quirks mode, layout issues | Removed DOCTYPE | 7 iterations |
| Dark text on dark bars | Labels invisible | Restored white default | 1 iteration |
| classList whitespace | DOMException crash | Combined class names | 1 iteration |
| CSS selectors not matching | Labels still invisible | Added all selector patterns | 1 iteration |
| SVG transform positioning | Progress bar offset | Added transform-box: fill-box | 1 iteration |

---

## Technical Discoveries

### Platform Behavior
- Dataiku's iframe wrapper does not include DOCTYPE (causes Quirks Mode warning, not fixable from plugin)
- Plugin body.html is a fragment, not a document

### Library Behavior
- Frappe Gantt's `custom_class` uses `classList.add()` which rejects whitespace
- Frappe Gantt applies custom_class to `.bar-wrapper` or `.bar-group`, not direct parent
- CSS selectors must account for Frappe's DOM structure variations

### CSS/SVG Insights
- SVG elements need `transform-box: fill-box` for transform-origin to work relative to element's bounding box
- Default transform-origin in SVG is relative to viewport, not element

---

## CLI Docs Candidates

Items to add to CLAUDE.md:

1. **Frappe Gantt custom_class**: Must be single class without spaces (classList.add() limitation)
2. **SVG transform centering**: Use `transform-box: fill-box` when scaling SVG elements with transforms
3. **Dataiku body.html**: Is a fragment, not a document - never add DOCTYPE

---

## Recommendations

### For Next Release
- Review junior developer work before committing to catch issues earlier
- Require intervention files for any multi-iteration work

### Process Improvements
- Add automated linting for common issues (DOCTYPE in body.html)
- Consider pairing for first feature implementation

### Technical Debt
- None introduced

---

## Lessons Learned

1. **Intervention files are mandatory** for multi-iteration work - 7 iterations could have been avoided with proper tracking
2. **Understand embedding context** - Plugin files are fragments in Dataiku's iframe
3. **Read error messages literally** - "Quirks Mode" points directly to DOCTYPE issues
4. **Test with actual DOM** - CSS selectors that look correct may not match library's DOM structure
5. **SVG transforms differ from HTML** - transform-origin behaves differently without transform-box
6. **Handoffs need documentation** - Without intervention file, senior had to reverse-engineer issues
