# Release Notes: v0.2.3

**Release Date:** 2025-12-21
**Type:** Bugfix
**Branch:** `bugfix/v0.2.3-fix-dependency-arrows`

---

## Summary

This release fixes a critical bug where dependency arrows between tasks were not rendering in the Gantt chart. The root cause was a type mismatch: Frappe Gantt expects `task.dependencies` as an array of task IDs, but the backend was providing a comma-separated string. Additionally, this release addresses a subtle Pandas type coercion issue where task IDs and dependency IDs had inconsistent string representations due to NaN presence in columns.

---

## Changes

### Fixed
- **Dependency Arrows Not Rendering**
  - **Symptom:** Tasks with configured dependencies showed no connecting arrows, despite valid data in the dependencies column.
  - **Root Cause 1:** Backend sent dependencies as comma-separated strings (`"task1,task2"`), but Frappe Gantt's `.map()` method expects arrays (`["task1", "task2"]`).
  - **Root Cause 2:** Pandas type mismatch - ID columns without NaN were read as int64 (e.g., `277` → `"277"`), while dependency columns with NaN were read as float64 (e.g., `276.0` → `"276.0"`), causing ID matching to fail.
  - **Fix:**
    - Converted dependencies to arrays throughout the pipeline (`task_transformer.py`, `dependency_validator.py`)
    - Created `_normalize_id()` helper that converts whole-number floats to int representation while preserving actual decimals
    - Updated `sort_utils.py` to handle both array and legacy string formats
    - Added comprehensive unit tests for ID normalization edge cases

---

## Files Modified

| File | Change Type | Description |
|------|-------------|-------------|
| `python-lib/ganttchart/task_transformer.py` | Modified | Added `_normalize_id()` helper; convert dependencies to arrays; normalize all IDs consistently |
| `python-lib/ganttchart/dependency_validator.py` | Modified | Return dependencies as arrays instead of strings |
| `python-lib/ganttchart/sort_utils.py` | Modified | Handle both array and string dependency formats for backward compatibility |
| `tests/python/unit/test_task_transformer.py` | Modified | Added `TestIDNormalization` class with 10 test methods |
| `plan/branch-open-protocol.md` | Modified | Added requirement to commit before User QA |
| `plugin.json` | Modified | Version bump to 0.2.3 |

---

## Testing

- **Unit Tests:** Added 10 new test methods in `TestIDNormalization` class covering:
  - Integer IDs
  - Whole-number float IDs (Pandas NaN column scenario)
  - Decimal float IDs
  - String IDs
  - NaN/None handling
  - Multiple dependencies
  - Whitespace trimming
  - Real-world Pandas type mismatch scenario
- **Manual Verification:**
  - Dependency arrows render correctly between tasks
  - Arrow direction is correct (from predecessor to successor)
  - Tasks without dependencies render normally
  - All data types (int, float, decimal, string) work for IDs and dependencies
  - No JavaScript errors in console

---

## Breaking Changes

None.

---

## Known Issues

None.

---

## Dependencies

None.

---

## Related Documents

- Spec: `plan/specs/bugfix-v0.2.3-spec.md`
- Post-mortem: `plan/post-mortems/v0.2.3-post-mortem.md`
