# Release Notes: v0.4.1

**Release Date:** 2025-12-22
**Type:** Bugfix
**Branch:** `bugfix/v0.4.1-fix-view-transitions`

---

## Summary

Critical bugfix release addressing view mode transition issues in the Frappe Gantt library. Fixes data rendering failures, scroll position problems, and Today button functionality across all view modes (Hour through Year).

---

## Changes

### Fixed
- **Data Fails to Populate on View Transitions**: Chart no longer renders blank when switching between view modes (especially Hour ↔ Quarter Day, Half Day ↔ Day)
  - Root cause: Library's `maintain_scroll=true` flag skipped date boundary recalculation
  - Fix: Removed flag to force proper date recalculation on every view change

- **Scroll Position Jumps to Wrong Date**: View mode changes now correctly scroll to Today instead of arbitrary positions
  - Root cause: Same `maintain_scroll` flag attempted to restore pixel position across different time scales
  - Fix: Disabled pixel-based scroll restoration; falls back to `scroll_to: "today"`

- **SVG Width 100% Causes Partial Render**: Fixed chart only partially rendering when transitioning FROM Hour view
  - Root cause: `set_dimensions()` only set pixel width conditionally; when container was already wide, it stayed at 100%
  - Fix: Always set pixel width based on grid row width

- **Month/Year View Today Button Broken**: Today button now works correctly in Month and Year views
  - Root cause: `get_closest_date()` reconstructed date from format string with trailing space; "2024-12 " and "2024 " parse as Invalid Date
  - Fix: Return original date object instead of format+reparse

- **Zoom-Out Transitions Don't Auto-Center on Today**: All view transitions now properly center on Today (Hour→Quarter Day, Day→Week, Week→Month)
  - Root cause: Library used `behavior: "smooth"` for scroll but immediately read `scrollLeft` before animation completed
  - Fix: Changed to `behavior: "instant"` for synchronous scroll

---

## Files Modified

| File | Change Type | Description |
|------|-------------|-------------|
| `resource/frappe-gantt.es.js` | Modified | 5 patches: remove !0, set_dimensions, get_closest_date, instant scroll |
| `resource/frappe-gantt.umd.js` | Modified | Same 5 patches for UMD bundle |
| `plugin.json` | Modified | Version bump 0.4.0 → 0.4.1 |
| `plan/frappe-gantt-upstream-bugs.md` | Added | Tracking document for library bugs |
| `plan/interventions/v0.4.1-intervention.md` | Added | Debugging session log |
| `plan/specs/bugfix-v0.4.1-spec.md` | Added | Original bugfix specification |

---

## Testing

- **Unit Tests:** N/A (changes are JavaScript library patches)
- **Manual Verification:** All 12 view transitions tested
  - Year ↔ Month ↔ Week ↔ Day ↔ Half Day ↔ Quarter Day ↔ Hour
  - Today button verified in all views
  - Auto-center on Today verified for all transitions

---

## Breaking Changes

None

---

## Known Issues

None introduced by this release.

---

## Dependencies

None changed.

---

## Library Patches Applied

This release patches 5 bugs in the bundled Frappe Gantt library:

| Bug | Severity | Patch Location |
|-----|----------|----------------|
| clientWidth on undefined | HIGH | scroll handler, set_scroll_position |
| maintain_scroll breaks view switch | HIGH | view_mode_select event listener |
| SVG width 100% | HIGH | set_dimensions() |
| Date parsing trailing space | HIGH | get_closest_date() |
| Smooth scroll timing | MEDIUM | set_scroll_position() |

See `plan/frappe-gantt-upstream-bugs.md` for full documentation and upstream reporting plans.

---

## Related Documents

- Spec: `plan/specs/bugfix-v0.4.1-spec.md`
- Intervention Log: `plan/interventions/v0.4.1-intervention.md`
- Upstream Bugs: `plan/frappe-gantt-upstream-bugs.md`
