# Release Notes: v0.9.4

**Release Date:** 2025-12-28
**Type:** Feature
**Branch:** `feature/v0.9.4-tooltip-polish`

---

## Summary

This release improves tooltip positioning and appearance. Tooltips now anchor to the task bar's bottom-left corner (trailing left with a gap) instead of following the mouse cursor, providing a more consistent and less intrusive user experience. Tooltip padding has been reduced and dark mode styling improved.

---

## Changes

### Added
- **CSS variable `--gantt-popup-gap`**: Theme-driven spacing between task bar and tooltip (default 24px)
- **Auto-flip positioning**: Tooltip automatically flips above the bar when there's no room below

### Fixed
- **Tooltip positioning (#66)**: Tooltip now anchors to task bar instead of following mouse cursor
  - Position: Trails left of bar's left edge with configurable gap
  - Prefers below bar, auto-flips above if near bottom of container
  - Boundary clamping prevents tooltip from exceeding container bounds
- **Tooltip appearance (#67)**: Reduced padding from 10px to 5px
  - Dark mode: Added 3px border + shadow for better contrast (eliminates white halo)

### Changed
- **Positioning approach**: Uses post-render correction via `requestAnimationFrame` instead of pre-positioning, which is more robust with Frappe Gantt's internal popup handling

---

## Files Modified

| File | Change Type | Description |
|------|-------------|-------------|
| `webapps/gantt-chart/app.js` | Modified | Added show_popup monkey-patch with post-render positioning correction |
| `resource/webapp/style.css` | Modified | Added --gantt-popup-gap variable, reduced popup padding, dark mode border styling |
| `plugin.json` | Modified | Version 0.9.3 â†’ 0.9.4 |
| `CLAUDE.md` | Modified | Added Frappe Gantt popup positioning gotcha |
| `plan/specs/feature-v0.9.4-spec.md` | Added | Feature specification |
| `plan/interventions/v0.9.4-intervention.md` | Added | Debugging session log |

---

## Testing

- **Unit Tests:** No Python changes (JS/CSS only)
- **Manual Verification:**
  - [x] Tooltip appears trailing left of bar with gap
  - [x] Tooltip flips above bar when near bottom
  - [x] Tooltip clamped within container bounds
  - [x] Padding reduced to 5px
  - [x] Dark mode: 3px border, no white halo
  - [x] Animation preserved (no visual jump)

---

## Breaking Changes

None

---

## Known Issues

None

---

## Dependencies

None

---

## Technical Notes

### Frappe Gantt Popup Behavior

The original approach (modifying `opts.x/y` before calling `show_popup`) didn't work because Frappe Gantt:
1. Treats popup coordinates as anchors
2. Re-centres vertically after render
3. Does not expose a positioning hook

The solution:
1. Call `originalShowPopup(opts)` first - let Frappe do its thing
2. Correct position in `requestAnimationFrame()` after render
3. Directly set `popup.style.left/top`
4. Temporarily disable transition to prevent visual jump

This approach is documented in CLAUDE.md for future reference.

---

## Related Documents

- Spec: `plan/specs/feature-v0.9.4-spec.md`
- Post-mortem: `plan/post-mortems/v0.9.4-post-mortem.md`
- Intervention Log: `plan/interventions/v0.9.4-intervention.md`
