# Release Notes: v0.4.0

**Release Date:** 2025-12-22
**Type:** Feature
**Branch:** `feature/v0.4.0-view-enhancements`

---

## Summary

This release delivers view enhancements for the Gantt chart, focusing on improved header label readability and user-controlled date boundaries. Responsive header abbreviations automatically adjust based on column width, and users can now constrain the chart timeline to specific date ranges.

---

## Changes

### Added
- **Fixed Start/End Date Parameters**: New configuration options to constrain chart timeline
  - `chartStartDate` and `chartEndDate` in YYYY-MM-DD format
  - Dates only narrow the range (won't expand beyond calculated task bounds)
  - Validation UI blocks rendering if start >= end with clear error message
  - Leave empty for automatic date calculation (existing behavior)

- **Responsive Header Abbreviations**: Labels adapt to column width
  - Week view: >= 50px shows "11 - 17" range, < 50px shows "11" only
  - Month view: >= 75px "January", >= 39px "Jan", < 39px "J"
  - Year view: >= 34px "2024", < 34px "24"

### Fixed
- **Header Text Collisions**: Added CSS overflow handling to prevent date labels from overlapping
  - `.upper-text` constrained with max-width and ellipsis truncation
  - `.lower-text` overflow hidden with ellipsis

- **Frappe Gantt clientWidth Error**: Patched library crash on view mode transitions
  - Root cause: `this.upperTexts.find()` returned undefined for stale DOM references
  - Fix: Added null guards in `frappe-gantt.umd.js` scroll handler

- **Responsive Labels Not Updating**: Fixed wrong property access
  - Was using `ganttInstance.config.view_mode` (object) instead of `ganttInstance.options.view_mode` (string)

---

## Files Modified

| File | Change Type | Description |
|------|-------------|-------------|
| `webapps/gantt-chart/webapp.json` | Modified | Added chartStartDate, chartEndDate params; columnWidth minI 20→25 |
| `webapps/gantt-chart/app.js` | Modified | Added adjustHeaderLabels(), applyDateBoundaryPatch(), responsive formatters |
| `resource/webapp/style.css` | Modified | Header collision CSS, sticky header attempt |
| `resource/frappe-gantt.umd.js` | Modified | Null guards for clientWidth access |
| `resource/frappe-gantt.es.js` | Modified | Same patches for consistency |
| `plugin.json` | Modified | Version bump 0.3.0 → 0.4.0 |

---

## Testing

- **Unit Tests:** Not applicable (Dataiku integration tests require DSS instance)
- **Manual QA Verification:**
  - [x] clientWidth error gone on view mode transitions
  - [x] Week view responsive labels working
  - [x] Month view responsive labels working
  - [x] Year view responsive labels working
  - [x] Date boundary controls functional
  - [x] Date validation UI displays errors correctly

---

## Breaking Changes

None

---

## Known Issues

| Issue | Severity | Target Version |
|-------|----------|----------------|
| Data fails to populate on Hour→Quarter Day→Half Day→Day transitions | HIGH | v0.4.1 |
| Today button in Month View jumps to first visible date | MEDIUM | v0.4.1 |
| Sticky header not working (CSS approach ineffective) | LOW | v0.4.2 |
| Cursor stays on static pixel on mode switch | LOW | v0.4.2 |

---

## Deferred Features (v0.4.2)

| Feature | Description |
|---------|-------------|
| Sticky Header | Requires JavaScript scroll sync (Option B) |
| Upper element year additions | Add year to Day, Half Day, Quarter Day, Hour, Week headers |
| Month letter visibility | Show all month letters at narrow widths |
| Upper elements decade format | Always show full decade (2020, 2030, 2040) |

---

## Dependencies

None added or removed.

---

## Related Documents

- Spec: `plan/specs/feature-v0.4.0-spec.md`
- Post-mortem: `plan/post-mortems/v0.4.0-post-mortem.md`
- Intervention Log: `plan/interventions/v0.4.0-intervention.md`
