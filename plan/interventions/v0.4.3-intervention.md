# v0.4.3 Intervention: Header Enhancements & View Persistence

## Branch
`feature/v0.4.3-header-enhancements-clean`

## Status
**Phase:** QA PASSED - Ready for PR

---

## Final Scope

| Issue | Title | Priority | Status |
|-------|-------|----------|--------|
| #16 | Persist view mode | medium | **COMPLETE** |
| #13 | Month letter visibility | low | **COMPLETE** |
| #12 | Year in upper headers | low | **DEFERRED** |
| #14 | Decade format | low | **DEFERRED** |

**Why #12 Deferred:** Attempted but fundamentally flawed - cannot infer years from month names alone without access to frappe-gantt's internal date data. Caused incorrect year labels and sticky label bugs.

**Why #14 Deferred:** Caused instability affecting other views during prior attempt (from abandoned branch).

---

## Implementation Summary

### #16: View Mode Persistence - COMPLETE
- Added `VALID_VIEW_MODES` constant for validation
- Added `hashString()` function (djb2 algorithm) for key privacy
- Added `getViewModeStorageKey()` function
- Added `loadPersistedViewMode()` with self-healing validation
- Added `saveViewMode()` function
- Modified `buildGanttConfig()` to load persisted mode
- Modified `on_view_change` to save `mode.name` (NOT mode object!)

### #13: Month Single-Letter - COMPLETE
- Changed: `if (columnWidth < 30)` → `if (columnWidth < 30 && viewMode !== 'Month')`
- Month view at narrow width now shows all 12 letters without skipping

---

## Key Gotcha Discovered

```javascript
// on_view_change: mode is OBJECT, not string!
on_view_change: function(mode) {
    const viewModeName = typeof mode === 'string' ? mode : mode.name;
    saveViewMode(webAppConfig.dataset, viewModeName);
}
```

---

## Commits

1. `bb387b0` - docs(v0.4.3): Set up clean branch with documentation artifacts
2. `78862e2` - feat(v0.4.3): Header enhancements and view mode persistence
3. `2ca11b2` - fix(v0.4.3): Sort upper-text by x-position (attempted #12 fix)
4. `7230471` - fix(v0.4.3): Remove broken year context feature (#12)

---

## Files Modified

| File | Changes |
|------|---------|
| `webapps/gantt-chart/app.js` | #16, #13 implementations |
| `plugin.json` | Version 0.4.2 → 0.4.3 |

---

## QA Results

- **#16 Persistence:** PASS - View mode persists across refresh
- **#13 Month letters:** PASS - All 12 letters visible at narrow width
- **Regression check:** PASS - No issues in Day/Week/Month/Year views
