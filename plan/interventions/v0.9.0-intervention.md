# v0.9.0 Intervention: Theming & Visual Polish

## Status: QA Round 2 - Awaiting Re-test

## Commits
1. `fb1be8c` - feat(v0.9.0): Initial implementation of all 6 issues
2. `5127dc6` - fix(v0.9.0): QA fixes for markers, pills, and dark mode
3. `2c5342f` - fix(v0.9.0): Markers now render above today line (#57)

## Scope (Revised)
- #34: Grid Lines Configuration
- #47: Pill Box Labels
- #54: Zoom carryover bug
- #57: Visual stacking order

## Deferred
- #31: Dark Mode Support → v0.9.1
- #49: Color Palette Selection → v0.9.2

---

## QA Status

| Issue | Initial QA | Fix Applied | Re-test |
|-------|-----------|-------------|---------|
| #57 Markers | FAIL | Yes - markers now in top-layer SVG group | Pending |
| #54 Zoom Bug | PASS | N/A | Done |
| #47 Pills | FAIL | Added diagnostic logging | Pending |
| #34 Grid Lines | PASS | N/A | Done |
| #49 Palettes | — | Deferred to v0.9.2 | — |
| #31 Dark Mode | — | Deferred to v0.9.1 | — |

---

## What Was Fixed (QA Round 1 → 2)

### #57 Markers
- `app.js`: stroke-width 2→3, triSize 5→8
- `style.css`: CSS backup with !important

### #47 Pills
- `app.js`: Refactored addPillBackgrounds() - batch getBBox reads, then batch writes
- Set explicit `fill` attribute (not relying on CSS)
- Added `opacity="1"` to prevent transparency

### #31 Dark Mode
- `body.html`: Added theme dropdown `<select id="theme-select">`
- `app.js`: Added getThemeStorageKey(), loadPersistedTheme(), saveTheme()
- `app.js`: Updated initTheme() to load persisted + sync dropdown
- `app.js`: Added setupThemeToggle() for dropdown handler
- `app.js`: Added updateStickyHeaderTheme() for header color
- `app.js`: Fixed setupStickyHeader() - removed hardcoded #ffffff
- `style.css`: Added .dark-theme .upper-text/.lower-text fill override
- `style.css`: Added .dark-theme .bar-progress visibility

---

## Files Modified

| File | Changes |
|------|---------|
| `webapps/gantt-chart/app.js` | Theme persistence, pill fixes, marker sizes |
| `webapps/gantt-chart/body.html` | Theme dropdown |
| `webapps/gantt-chart/webapp.json` | Theme, grid, palette params |
| `webapps/gantt-chart/backend.py` | Pass colorPalette |
| `resource/webapp/style.css` | Dark mode, palettes, pills, markers |
| `python-lib/ganttchart/color_mapper.py` | PALETTES dict, get_palette() |
| `python-lib/ganttchart/task_transformer.py` | color_palette in config |
| `plugin.json` | Version 0.9.0 |

---

## Re-test Reproduction Steps

### #57 Markers
1. Enable "Show expected progress" in View Settings
2. Find tasks spanning today's date
3. Expected: Markers 3px wide, 8px triangles, ABOVE today line

### #47 Pills
1. Look at task labels on any colored bars
2. Expected: White rounded pill backgrounds behind text
3. Console: `"Pill backgrounds added: N of M bars"`

### #31 Dark Mode
1. Use theme dropdown (next to view mode select)
2. Select "Dark" - header bar should turn dark
3. Refresh - theme should persist
4. Test "Auto" mode

### #49 Palettes (Deferred)
1. Select color column
2. Switch palette: Classic → Pastel → Dark → Dataiku
3. Bar colors should change immediately

---

## Notes
- All 122 unit tests pass
- Theme persists per-chart (localStorage key uses hashed dataset name)
- Theme is NOT per-view-mode like zoom is
