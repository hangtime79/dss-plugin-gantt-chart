# v0.9.0 Intervention: Theming & Visual Polish

## Status: QA Fixes Complete - Ready for Re-test

## Scope
- #31: Dark Mode Support
- #34: Grid Lines Configuration
- #47: Pill Box Labels
- #49: Color Palette Selection
- #54: Zoom carryover bug
- #57: Visual stacking order

## Implementation Order (per spec)
1. **#57 Stacking Order** - Done
2. **#54 Zoom Bug** - Done
3. **#47 Pill Box Labels** - Done
4. **#34 Grid Lines Config** - Done
5. **#49 Color Palettes** - Done
6. **#31 Dark Mode** - Done

## Progress

### Part 1: Stacking Order (#57)
- [x] Added ensureStackingOrder() in app.js
- [x] Moves today-highlight after bars (renders on top)
- [x] Moves expected-progress-markers to top layer
- [x] CSS documentation in style.css

### Part 2: Zoom Bug (#54)
- [x] Added edgeToEdgeExpectedViewMode tracking
- [x] Added view mode mismatch guard before re-render
- [x] Prevents zoom carryover during rapid view switching

### Part 3: Pill Box Labels (#47)
- [x] Added addPillBackgrounds() in app.js
- [x] Inserts SVG rect elements behind each label
- [x] CSS for .bar-label-pill styling
- [x] Handles both internal and external (.big) labels

### Part 4: Grid Lines Config (#34)
- [x] Added parameters to webapp.json:
  - showVerticalGridLines (BOOLEAN)
  - showHorizontalGridLines (BOOLEAN)
  - gridLineOpacity (INT 0-100)
- [x] Implemented applyGridSettings() in app.js
- [x] Applies to .tick (vertical) and .row-line (horizontal)

### Part 5: Color Palettes (#49)
- [x] Added colorPalette SELECT parameter to webapp.json
- [x] Added PALETTES dict and get_palette() to color_mapper.py
- [x] Updated create_color_mapping() to accept palette_name
- [x] Added color_palette to TaskTransformerConfig
- [x] Updated backend.py to pass colorPalette
- [x] CSS for pastel, dark, and Dataiku palettes

### Part 6: Dark Mode (#31)
- [x] Added theme SELECT parameter to webapp.json
- [x] CSS dark-theme class with variable overrides
- [x] CSS dark mode overrides for all UI components
- [x] Implemented initTheme() and applyTheme() in app.js
- [x] System preference detection for "auto" mode
- [x] Event listener for system theme changes

### Final
- [x] Bump version 0.8.0 to 0.9.0 in plugin.json
- [x] Run unit tests (122 passed)
- [x] Commit

## Files Modified
| File | Status | Changes |
|------|--------|---------|
| `webapps/gantt-chart/webapp.json` | Done | Theme, grid, palette params |
| `webapps/gantt-chart/app.js` | Done | Theme, grid, zoom, stacking, pills |
| `resource/webapp/style.css` | Done | Dark mode, palettes, pills, stacking |
| `python-lib/ganttchart/color_mapper.py` | Done | Palette definitions, get_palette() |
| `python-lib/ganttchart/task_transformer.py` | Done | color_palette in config |
| `webapps/gantt-chart/backend.py` | Done | Pass colorPalette to transformer |
| `plugin.json` | Done | Version 0.9.0 |

## Notes
- All unit tests pass (122 tests)
- SVG z-index doesn't work - using DOM reordering for stacking
- Dark mode uses CSS variable overrides for maintainability
- Palette defaults to "classic" for backwards compatibility
