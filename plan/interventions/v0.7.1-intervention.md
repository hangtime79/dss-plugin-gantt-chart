# Intervention Log: v0.7.1 Sticky Header Fix

**Branch:** `bugfix/v0.7.1-sticky-header-narrow-content`
**Started:** 2025-12-26
**Status:** ✅ QA PASSED - Ready for Branch Exit

---

## Issue

**#21:** Sticky header janky when chart content narrower than viewport

When SVG content doesn't fill the container width (e.g., Year view with short date range), the sticky header becomes choppy during vertical scroll due to browser paint/composite behavior.

---

## Solution (v10) - Per-View Zoom with Edge-to-Edge

### Core Concepts

1. **Per-view zoom tracking**: Each view mode (Day, Week, Month, Year) has independent column width
2. **Per-view floor calculation**: Each view has its own minimum based on `containerWidth / columnCount`
3. **Edge-to-edge enforcement**: Content always fills viewport width
4. **User feedback**: Messages when zoom limits reached

### Key Constants
```javascript
const ABSOLUTE_FLOOR = 25;       // Never render below 25px columns
const COLUMN_WIDTH_BASELINE = 75; // 100% zoom reference
```

### Key Data Structures
```javascript
// User's zoom preference per view
let columnWidthByViewMode = {
    'Hour': 75, 'Quarter Day': 75, 'Half Day': 75,
    'Day': 75, 'Week': 75, 'Month': 75, 'Year': 75
};

// Calculated floor per view (containerWidth / columnCount)
let minColumnWidthByViewMode = {
    'Hour': 25, 'Quarter Day': 25, 'Half Day': 25,
    'Day': 25, 'Week': 25, 'Month': 25, 'Year': 25
};
```

### Core Formula
```javascript
// After each render:
viewFloor = MAX(containerWidth / dates.length, ABSOLUTE_FLOOR)
renderWidth = MAX(currentColumnWidth, viewFloor)
```

### Key Functions

| Function | Purpose |
|----------|---------|
| `ensureEdgeToEdgeContent()` | Calculate floor, auto-zoom if needed |
| `adjustZoom(delta)` | Manual zoom with view floor enforcement |
| `showZoomLimitMessage(msg)` | User feedback on limits |
| `updateZoomIndicator()` | Show percentage (based on 75px = 100%) |

---

## What Works (All QA Passed)

- ✅ Per-view independent zoom tracking
- ✅ Edge-to-edge content fills viewport
- ✅ View floor prevents zoom below minimum
- ✅ User feedback on zoom limits (message survives render)
- ✅ Config panel spinner feedback
- ✅ Smooth scrolling (main fix)
- ✅ Per-view zoom preservation across view switches

## Issues Created for Future Releases

- #52: Markers misaligned at lower granularities (Hour, Day)
- #53: Feature request for zoom stops at 25/50/75/100%
- #54: Intermittent zoom carryover between views (low priority)

---

## Files Modified

| File | Changes |
|------|---------|
| `webapps/gantt-chart/app.js` | Per-view zoom, new formula, feedback |
| `resource/webapp/style.css` | Zoom limit banner styles |
| `plugin.json` | Version 0.7.0 → 0.7.1 |

---

## Commit History

| Hash | Description |
|------|-------------|
| `d75716a` | v12 - Message survives render (insert before container) |
| `f5abe16` | v11 - Detect wrong column width after view switch |
| `bf3aecd` | v10 - Per-view zoom with edge-to-edge |
| `7d260b0` | v9 - Removed MAX_ZOOM cap from manual zoom |
| `36bf36d` | v9a - Removed minColumnWidthForViewport floor |
| `b5f919a` | v8 - Fixed guard timing with double rAF |
| `27e0b4d` | v7 - Simplified, removed view mode manipulation |
| `a098530` | v6 - Added view mode passing |
| `d0e5372` | v5 - Added localStorage caching |
| `5d2534d` | v4 - Added view mode reset |
| `3467f69` | v3 - Basic minimum floor |

---

## Recovery After Context Compaction

1. **Read this file first**
2. **Check current state:**
   ```bash
   git log --oneline -1
   git status
   ```
3. **Key files:**
   - `webapps/gantt-chart/app.js` - main logic
   - `plan/interventions/render-flow-pseudocode.md` - flow documentation
4. **Await user QA feedback for v10**
5. **If QA passes:** Run branch-exit-protocol for merge/release

## If QA Fails

Common issues and fixes:
- **Infinite loop on view change:** Check `edgeToEdgeInProgress` guard
- **Zoom not working:** Check `columnWidthByViewMode[currentViewMode]`
- **Wrong floor:** Check `minColumnWidthByViewMode` calculation
- **Zoom indicator wrong:** Check `COLUMN_WIDTH_BASELINE` (75)
