# v0.5.1 Intervention - Visual Polish

## Branch
`bugfix/v0.5.1-visual-polish`

## Current Commit
`359ef81` - fix(v0.5.1): simplify progress bar to plain rectangle (#28)

## Issues Being Fixed
- **#27**: Remove 1px outline from task bars
- **#28**: Progress bar bleeding outside task bar corners

---

## Completed Work

### 1. Outline Removal (#27) ✅
**File:** `resource/webapp/style.css` (lines 592-595)

```css
/* Remove dated 1px outline from task bars (#27) */
.gantt .bar-wrapper .bar {
    outline: none !important;
}
```

### 2. Progress Bar Bleed Fix (#28) ✅
**File:** `webapps/gantt-chart/app.js` - `fixProgressBarRadius()` function

**Problem discovered during implementation:**
- Original spec assumed `bar_corner_radius: 3` (small radius)
- User's config has `bar_corner_radius: 15` (large radius)
- With large corner radii, the 60% height progress bar geometrically cannot fit inside the task bar's curved corners
- scaleY(0.6) only affects height, not corner geometry

**Solution implemented:**
1. Create SVG `<clipPath>` elements matching each task bar's exact shape
2. Apply clipPath to progress bars so any bleed is clipped
3. Set progress bar to plain rectangle (rx=0, ry=0) - let clipPath handle corner shaping
4. Extend progress bar x and width by cornerRadius to fill corner pixels completely

**Key code (`fixProgressBarRadius()`):**
- Creates `<defs id="gantt-progress-clips">` in SVG
- For each bar-wrapper:
  - Creates clipPath with task bar's dimensions
  - Applies `clip-path="url(#progress-clip-N)"` to progress bar
  - Sets `rx=0, ry=0` (plain rectangle)
  - Extends progress bar: `x = x - cornerRadius`, `width = width + cornerRadius*2`

### 3. Version Bump ✅
**File:** `plugin.json`
- Changed from `"0.5.0"` to `"0.5.1"`

---

## Files Modified

| File | Changes |
|------|---------|
| `plugin.json` | Version 0.5.0 → 0.5.1 |
| `resource/webapp/style.css` | Added outline:none rule, updated progress bar comment |
| `webapps/gantt-chart/app.js` | Added `fixProgressBarRadius()` with clipPath logic |
| `plan/specs/bugfix-v0.5.1-spec.md` | Created (original spec, now outdated) |

---

## Current Status

### Awaiting User QA ⏳

Last change extends progress bar beyond task bounds to fill corner pixels. ClipPath clips it to correct shape.

**QA Checklist:**
- [ ] Task bars have NO gray outline/border
- [ ] Progress bars don't bleed outside task bar corners
- [ ] Progress bar corners are filled completely (no missing pixels)
- [ ] Works at 0%, partial (e.g., 50%), and 100% progress
- [ ] Works with color column selected
- [ ] Works with no color column (gray default bars)
- [ ] View mode changes don't break the fix

---

## To Resume

1. User restarts Dataiku/browser
2. Reload plugin (Actions → Reload)
3. Test the QA checklist above
4. If issues found, debug using:
   - Console logs: "Created defs element...", "Fixing progress bar radius for N bars"
   - Check for `<defs id="gantt-progress-clips">` in SVG
   - Check progress bars have `clip-path="url(#progress-clip-N)"` attribute
5. If QA passes, proceed to PR/merge

---

## Technical Notes

- `classList.add()` doesn't work on SVG elements - use `setAttribute('id', ...)` instead
- Progress bar structure changed: now inside `bar-group`, not sibling
- Console logs added for debugging (can remove before final merge)
- The fix runs on initial render AND on view mode change (bars are recreated)
- Simplified approach: progress bar is plain rectangle (rx/ry=0), clipPath handles all corner shaping
