# Intervention Log: v0.4.0 View Enhancements

**Branch:** `feature/v0.4.0-view-enhancements`
**Started:** 2025-12-21
**Status:** Ready for QA

---

## Implementation Plan (TODOs)

### Feature 1: Fix Header Text Collisions
- [x] Add `.upper-text` max-width constraint
- [x] Add `.upper-text` overflow: hidden, text-overflow: ellipsis
- [x] Add `.lower-text` overflow handling
- [x] Add narrow view font size adjustment
- [x] Add JS label adjustment for very narrow views

### Feature 2: Sticky Header Fix
- [x] Reinforce `.grid-header` sticky positioning in custom CSS
- [x] Ensure proper z-index stacking
- [x] Background color for header to prevent content showing through

### Feature 3: Date Boundary Controls
- [x] Add "Date Boundaries" separator to webapp.json
- [x] Add `chartStartDate` parameter (STRING type)
- [x] Add `chartEndDate` parameter (STRING type)
- [x] Implement monkey-patch for `setup_gantt_dates` in app.js
- [x] Add date validation (format check, start < end)
- [x] Add auto-adjustment for start >= end case

### Feature 4: JS Enhancements
- [x] Add `adjustHeaderLabels()` function for narrow views
- [x] Add `applyDateBoundaryPatch()` function
- [x] Update `on_view_change` callback to call label adjustment
- [x] Ensure all functions run after `requestAnimationFrame`

### Finalization
- [x] Version bump plugin.json: 0.3.0 → 0.4.0
- [x] Commit all changes (86575a8)
- [x] Notify user for QA testing

---

## Feature Status

| # | Feature | Status | Notes |
|---|---------|--------|-------|
| 1 | Fix Header Text Collisions | ✅ Complete | CSS overflow handling in style.css |
| 2 | Sticky Header Fix | ✅ Complete | CSS stacking context in style.css |
| 3 | Date Boundary Controls | ✅ Complete | webapp.json + app.js monkey-patch |
| 4 | JS Enhancements | ✅ Complete | adjustHeaderLabels() + applyDateBoundaryPatch() |
| 5 | Version Bump | ✅ Complete | 0.3.0 → 0.4.0 |

---

## Session Log

### 2025-12-21 - Initial Implementation

#### Step 1: CSS Fixes for Header Collisions and Sticky Header

**File:** `resource/webapp/style.css`

**Planned Changes:**
```css
/* Header text collision fix */
.gantt-container .upper-text {
    max-width: calc(var(--gv-column-width, 45px) * 4);
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.gantt-container .lower-text {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

/* Sticky header reinforcement */
.gantt-container .grid-header {
    position: sticky;
    top: 0;
    z-index: 1001;
    background-color: var(--g-header-background, #fff);
}
```

**Rationale:**
- `.upper-text` in Frappe Gantt uses `width: fit-content` which allows text to extend indefinitely
- No overflow handling causes "December 2024" to overlap adjacent month labels
- Narrow views (Hour, Quarter Day) have small column widths where text doesn't fit

**Status:** Pending edit approval

---

## Files Modified

| File | Status | Description |
|------|--------|-------------|
| `resource/webapp/style.css` | ✅ Complete | Header collision + sticky fixes |
| `webapps/gantt-chart/webapp.json` | ✅ Complete | Date boundary parameters |
| `webapps/gantt-chart/app.js` | ✅ Complete | Date constraints + label adjustment |
| `plugin.json` | ✅ Complete | Version bump to 0.4.0 |
| `plan/specs/feature-v0.4.0-spec.md` | ✅ Created | Feature specification |

---

## Issues Encountered

*None yet*

---

## Testing Notes

### Pre-QA Checklist
- [ ] Header labels don't overlap in any view mode
- [ ] Header stays fixed during vertical scroll
- [ ] Date boundaries work when set
- [ ] Date boundaries revert to auto when cleared
- [ ] Invalid dates handled gracefully
- [ ] View mode switching works correctly

---

## Rollback Commands

```bash
git checkout main -- resource/webapp/style.css
git checkout main -- webapps/gantt-chart/webapp.json
git checkout main -- webapps/gantt-chart/app.js
git checkout main -- plugin.json
```
