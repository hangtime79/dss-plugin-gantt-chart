# Intervention Log: v0.7.0 Expected Progress & Polish

**Branch:** `feature/v0.7.0-expected-progress-and-polish`
**Started:** 2025-12-26
**Status:** ðŸ”„ IN PROGRESS - Awaiting QA Round 2

---

## Issues Being Addressed

| Issue | Title | Status |
|-------|-------|--------|
| #33 | Expected Progress Indicator | ðŸ”„ CSS error fixed, awaiting QA |
| #45 | Bar corner radius default to 10 | âœ… QA Passed |
| #43 | Remove 'Disable all Editing' option | âœ… QA Passed |
| #42 | Weekend highlighting off by default | âœ… QA Passed |
| #38 | Float dependency strings normalization | ðŸ”„ CSS error fixed, awaiting QA |
| #37 | Pandas deprecation warning | âœ… Code correct (no param used) |

---

## Current State

### Commits on Branch
1. `6fbc424` - feat(v0.7.0): add expected progress indicator and polish
2. `79b21b3` - fix(v0.7.0): rename expected_progress to _expected_progress and add debug logging

### What's Done
- [x] webapp.json: barCornerRadius default 3â†’10, highlightWeekends default trueâ†’false
- [x] webapp.json: Removed readonly option, added showExpectedProgress toggle
- [x] app.js: Hardcoded readonly=true, added marker injection function
- [x] task_transformer.py: Added _calculate_expected_progress(), fixed float normalization
- [x] style.css: Added expected progress marker styling
- [x] Tests: 117 passing (5 new for expected progress)

### What's Pending
- [ ] QA Round 2: Verify CSS selector error is fixed
- [ ] QA Round 2: Verify markers appear (check console debug output)
- [ ] If markers still don't show, debug using console output

---

## QA Round 1 Results

### Passed
- [x] #45 - Bar corners rounded (radius 10)
- [x] #42 - Weekend highlighting OFF by default
- [x] #43 - No "Read-only" option in Behavior

### Failed (Fixed in commit 79b21b3)
- [ ] #33 - Expected progress toggle exists but markers don't show
- [ ] #38 - Float values cause CSS selector error: `.highlight-55.67`

---

## Fix Applied: Rename to `_expected_progress`

**Problem:** Frappe-gantt uses task properties for CSS classes. The `expected_progress` float (55.67) became `.highlight-55.67` which is invalid CSS.

**Solution:** Prefix with underscore: `_expected_progress`. Frappe-gantt ignores underscore-prefixed properties.

**Debug logging added** to console:
- "Adding expected progress markers for X tasks"
- "Tasks with _expected_progress: Y"
- "Found bar wrappers: Z"
- "Expected progress markers added: N"

---

## QA Round 2 Instructions

```
1. Reload plugin in Dataiku
2. Open browser console (F12)
3. Enable "Show expected progress" toggle
4. Load chart with tasks spanning today
5. Check console output and report:
   - Is CSS selector error gone?
   - What do debug logs show?
   - Are markers visible?
```

---

## Files Modified

| File | Changes |
|------|---------|
| `webapps/gantt-chart/webapp.json` | Config defaults, removed readonly, added showExpectedProgress |
| `webapps/gantt-chart/app.js` | readonly=true, expected progress markers, debug logging |
| `python-lib/ganttchart/task_transformer.py` | _calculate_expected_progress, _expected_progress field, float normalization |
| `python-lib/ganttchart/date_parser.py` | Comment update |
| `resource/webapp/style.css` | Expected progress marker styling |
| `plugin.json` | Version 0.7.0 |
| `tests/python/unit/test_task_transformer.py` | 5 new expected progress tests |

---

## Recovery Notes

If resuming after context clear:
1. Read this file first
2. Branch is `feature/v0.7.0-expected-progress-and-polish`
3. Awaiting QA Round 2 results
4. If markers still don't show, analyze console debug output
5. Key function: `addExpectedProgressMarkers()` in app.js (~line 847)
